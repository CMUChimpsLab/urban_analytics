<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
    fill: none;
    stroke: black;
}

.place {
    stroke: black;
    fill: red;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 1024,
    height = 768;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var projection = d3.geo.mercator()
    .center([-79.98, 40.431667]) //-80, 40.441667 is the center of pgh
    .scale(230000) // ad hoc hacky, works
    .translate([width/2, height/2]);

// transforms a ... GeometryCollection?... object into a svg path 'd' string
var path = d3.geo.path().projection(projection);
// transforms a tweet object into a svg path 'd' string
var tweetsPath = function(tweet) {
    // some tweets don't have coordinates, just a tweet.place.bounding_box
    // (which can be huge, like 7 degrees lat or lon, so forget it)
    // Note that there is still useful info in tweet.place (like "Pittsburgh")
    // Anyway I think path(null) just returns null, which works ok
    return path(tweet.coordinates);
}

var pt1 = {
    type: "GeometryCollection",
    geometries: [
        {
            type: "Point",
            properties: { name: "Pittsburgh Center" },
            coordinates: [ -80, 40.441667 ] // center of pgh, just for testing
        }, 
        {
            type: "Point",
            properties: { name: "point 2"},
            coordinates: [-79.99, 40.451667]
        }
    ] 
};

// svg.append("path")
//     .datum(pt1)
//     .attr("d", path)
//     .attr("class", "place")

d3.json("neighborhoodstopo.json", function(error, nghds) {
    var neighborhoods = topojson.feature(nghds, nghds.objects.neighborhoods);
    svg.append("path")
        .datum(neighborhoods)
        .attr("d", path);
});

var tweets_for_later; // for debugging
d3.json("tweets.json", function(error, tweets) {
    tweets_for_later = tweets
    svg.selectAll(".tweet")
        .data(tweets)
      .enter().append("path") // .enter() means "if there's more data than dom elements, do this for each new one"
        .attr("d", tweetsPath) // calls tweetsPath on each tweet
        .attr("class", "tweet")
     
    // svg.selectAll(".tweet-label")
    //     .data(tweets)
    //   .enter().append("text")
    //     .attr("class", "tweet-label")
    //     .attr("transform", function(d) {
    //         if (d.coordinates)
    //             return "translate(" + projection(d.coordinates.coordinates) + ")";
    //         else
    //             return null;
    //     })
    //     .text(function(d) {return d.user.screen_name;});
            
});

</script>
</body>
